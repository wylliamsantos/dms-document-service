---
spring:
  main:
    banner-mode: off
  mvc:
    pathmatch:
      matching-strategy: "ant-path-matcher"
  application:
    group: dms
    name: dms-document-service
  cache:
    ehcache:
      config: classpath:ehcache.xml
  security:
    oauth2:
      resourceserver:
        jwt:
          issuer-uri: ${KEYCLOAK_ISSUER_URI:http://localhost:8180/realms/dms}
management:
  endpoints.web.exposure.include: 'health,prometheus,metrics'
  endpoint:
    metrics.enabled: true
    prometheus.enabled: true
  metrics:
    tags:
      application: ${spring.application.name}
    distribution:
      percentiles-histogram:
        http.server.requests: true
        dms.http.server.latency: true
  health:
    consul.enabled: false
    vault.enabled: false
---
spring:
  config:
    activate:
      on-profile: default
    import: "vault://secretv2/${spring.application.group}/${spring.application.name},consul:/config/${spring.application.group}/${spring.application.name}"
  cloud:
    consul:
      scheme: https
      host: ${CONSUL_HOST:consul.dms-dev.in}
      port: 443
      config:
        format: YAML
        acl-token: ${CONSUL_TOKEN:}
    vault:
      uri: ${VAULT_URI:https://vault.dms-dev.in:443}
      fail-fast: true
      scheme: https
      authentication: ${VAULT_AUTH:TOKEN}
      token: ${VAULT_TOKEN:}
      kubernetes:
        role: ${spring.application.group}-${spring.application.name}
        kubernetes-path: ${CLUSTER_NAME}
  sleuth:
    sampler:
      probability: 1.0
  zipkin:
    base-url: ${ZIPKIN_URL:http://jaeger-collector.observability.svc.cluster.local:9411}

dms:
  contentTypes: "image/jpeg#image/png#image/tiff#application/pdf#text/plain#image/bmp#application/octet-stream#video/mp4#video/webm#video/ogg"
  billing:
    webhook-secret: ${DMS_BILLING_WEBHOOK_SECRET:}
    provider:
      enabled: ${DMS_BILLING_PROVIDER_ENABLED:false}
      base-url: ${DMS_BILLING_PROVIDER_BASE_URL:}
      api-key: ${DMS_BILLING_PROVIDER_API_KEY:}
      subscription-path: ${DMS_BILLING_PROVIDER_SUBSCRIPTION_PATH:/v1/subscriptions/{id}}
    user-directory:
      enabled: ${DMS_BILLING_USER_DIRECTORY_ENABLED:false}
      base-url: ${DMS_BILLING_USER_DIRECTORY_BASE_URL:}
      api-key: ${DMS_BILLING_USER_DIRECTORY_API_KEY:}
      tenant-users-count-path: ${DMS_BILLING_USER_DIRECTORY_TENANT_USERS_COUNT_PATH:/v1/tenants/{tenantId}/users/count}
  cors:
    allowed-origins: ${DMS_CORS_ALLOWED_ORIGINS:http://localhost:5173}
    allowed-methods: ${DMS_CORS_ALLOWED_METHODS:GET,POST,PUT,DELETE,OPTIONS}
    allowed-headers: ${DMS_CORS_ALLOWED_HEADERS:*}
    allow-credentials: ${DMS_CORS_ALLOW_CREDENTIALS:true}
  security:
    environment: ${DMS_SECURITY_ENVIRONMENT:dev}
    redirect-root-to-swagger-enabled: ${DMS_SECURITY_REDIRECT_ROOT_TO_SWAGGER_ENABLED:true}
    cors:
      fail-on-insecure-production-config: ${DMS_SECURITY_CORS_FAIL_ON_INSECURE_PRODUCTION_CONFIG:true}
    rate-limit:
      enabled: ${DMS_SECURITY_RATE_LIMIT_ENABLED:true}
      backend: ${DMS_SECURITY_RATE_LIMIT_BACKEND:in-memory}
      redis-key-prefix: ${DMS_SECURITY_RATE_LIMIT_REDIS_KEY_PREFIX:dms:rate-limit}
      requests-per-minute: ${DMS_SECURITY_RATE_LIMIT_REQUESTS_PER_MINUTE:120}
      critical-path-limits: ${DMS_SECURITY_RATE_LIMIT_CRITICAL_PATH_LIMITS:/v1/documents/multipart=30,/v1/documents/base64=30,/v1/documents/presigned-url=60,/v1/billing/webhook=60}
